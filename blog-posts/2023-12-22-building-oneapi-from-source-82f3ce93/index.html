<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=author content="Sriram Ramkrishna"><title>Building oneAPI from Source | Portfolio</title><link rel=stylesheet href=/css/main.min.a2ccd84ab36a329497bc48ab2b3cbdeaeed09d6f252ddd6de473497bbe9b7687.css integrity="sha256-oszYSrNqMpSXvEirKzy96u7QnW8lLd1t5HNJe76bdoc=" crossorigin=anonymous><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script></head><body><header><div class=container><div class=site-title><a href=/><img src=/images/sri-headshot.jpg alt="Sriram Ramkrishna" class=headshot-small>
<span>Portfolio</span></a></div><nav><ul><li><a>About</a></li><li><a href=https://linkedin.com/in/sriram-ramkrishna rel=noopener target=_blank><svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-label="LinkedIn"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg></a></li><li><a href=https://github.com/sramkrishna/ rel=noopener target=_blank><svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-label="GitHub"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg></a></li><li><a href=https://gitlab.gnome.org/sri rel=noopener target=_blank><svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-label="GitLab"><path d="M23.6004 9.5927l-.0337-.0862L20.3.9814a.851.851.0 00-.3362-.405.8748.8748.0 00-.9997.0539.8748.8748.0 00-.29.4399l-2.2055 6.748H7.5375l-2.2057-6.748a.8573.8573.0 00-.29-.4412.8748.8748.0 00-.9997-.0537.8585.8585.0 00-.3362.4049L.4332 9.5015l-.0325.0862a6.0657 6.0657.0 002.0119 7.0105l.0113.0087.03.0213 4.976 3.7264 2.462 1.8633 1.4995 1.1321a1.0085 1.0085.0 001.2197.0l1.4995-1.1321 2.4619-1.8633 5.006-3.7489.0125-.01a6.0682 6.0682.0 002.0094-7.003z"/></svg></a></li></ul></nav></div></header><main><h1>Building oneAPI from Source</h1><time datetime=2023-12-22T06:08:31+00:00>December 22, 2023</time><h2><p>Build oneAPI completely from git</p></h2><p>I'm back!! A few raw posts have been languishing and I decided the end of the year was the perfect time to put them out there. This will be one of three (hopefully).</p><p>I'm going to focus on how ￼to build oneAPI from git. This is somewhat of a return to my earlier blog post where I talked about how to build the DPC++ compiler and it included the binary versions of the openCL and level zero run time.</p><p>That's all well and good but let's consider how we could build the run time from git completely. The ability to do reproducible builds is going to be important later when we dive into buildimg packaging that is up to date and available on any Linux distro.</p><p>The build only supports Intel hardware at this point since level zero doesn't support NVidia or AMD GPUs. If you are looking for such support, you might consider Codeplay's plugins that will allow you to use NVidia and AMD hardware.</p><p>These blog pages typically only focus on what we can do from an open source perspective and won't really focus on anything that has binary blobs if we can avoid it.</p><p>DISCLAIMER: Please don't use this set up for a production environment. It is not well tested. If you find any problems, please reach out in the comments so that I can help debug and update the blog post appropriately.</p><h2><p>Setting up the build environment</p></h2><p>I like to use containers which makes it easy to quickly set up and automate using distrobox.</p><p>You should be able to use whatever Linux distribution you want as long as you can install distrobox. You can, of course, use a virtual machine to accomplish this. I've used Vagrant successfully.</p><p>Assuming that you have distrobox installed - let's get to it.</p><p>Decide where you want to have the build for instance: ~/src/oneapi-build.<br></p><div class="highlight js-code-highlight"><pre class="highlight plaintext"><code>$ distrobox create --image docker.io/library/ubuntu 20.04 --name "oneAPIBuild"
$ distrobox enter oneAPIBuild
</code></pre></div><p>You should now be in a container running Ubuntu 20.04.</p><h3><p>Install the appropriate packages</p></h3><div class="highlight js-code-highlight"><pre class="highlight plaintext"><code>$ sudo apt-get install -y build-essential git libssl-dev flex bison libz-dev python3-mako python3-pip automake autoconf libtool pkg-config ruby
</code></pre></div><p>You will need a recent version of cmake for the builds. The one that comes with 20.04 is too old.<br></p><div class="highlight js-code-highlight"><pre class="highlight plaintext"><code>$  wget https://github.com/Kitware/CMake/releases/download/v3.28.1/cmake-3.28.1.tar.gz
$ tar xvfpz cmake-3.28.1.tar.gz
$ cd cmake-3.28.1
$ ./boostrap
$ ./configure
$ make 
$ sudo make install
</code></pre></div><p>Now you should have everything you need for the build.</p><h3><p>Understanding the oneAPI Build</p></h3><p>There are a number of prerequisites before you start the build. Here is a graphic of how the oneAPI build is put together.</p><p>The order of build is:</p><p>1) Intel Graphics Engine and i￼ts relevant prerequisites which consist of:</p><ul><li>Intel Graphics Compiler (igc)<ol><li>SPIRV Headers</li><li>SPIRV Tools</li><li>copy of the llvm project</li><li>vc-intrinsics</li><li>intel graphcis compiler
2) ocl-icd
3) GMMLib
4) NEO - Intel Compute Runtime - NEO is the primary GPU graphics driver and uses OpenCL to talk to the GPU.</li></ol></li><li>Has the following pre-requisites:<ol><li>Intel graphics compiler (IGC)</li><li>GMMLib
6) Level Zero
7) DPC++ SYCL Compiler
8) oneTBB Library</li></ol></li></ul><p>That's the progression to get the full build going.</p><h3><p>Intel Graphics Engine</p></h3><p>Let's start building the first prerequisites for the NEO which is the Intel Graphics Engine:<br></p><div class="highlight js-code-highlight"><pre class="highlight plaintext"><code>$ mkdir igc-workspace &amp;&amp; cd igc-workspace
$ git clone https://github.com/KhronosGroup/SPIRV-Headers.git --depth 1
<p>$ git clone <a href=https://github.com/KhronosGroup/SPIRV-Tools.git>https://github.com/KhronosGroup/SPIRV-Tools.git</a> &ndash;depth 1</p>
<p>$ git clone -b llvmorg-14.0.5 <a href=https://github.com/llvm/llvm-project>https://github.com/llvm/llvm-project</a> llvm-project &ndash;depth 1</p>
<p>$ git clone -b ocl-open-140 <a href=https://github.com/intel/opencl-clang>https://github.com/intel/opencl-clang</a> llvm-project/llvm/projects/opencl-clang &ndash;depth 1</p>
<p>$ git clone -b llvm_release_140 <a href=https://github.com/KhronosGroup/SPIRV-LLVM-Translator>https://github.com/KhronosGroup/SPIRV-LLVM-Translator</a> llvm-project/llvm/projects/llvm-spirv &ndash;depth 1</p>
<p>$ git clone <a href=https://github.com/intel/vc-intrinsics>https://github.com/intel/vc-intrinsics</a> &ndash;depth 1</p>
<p>$ git clone <a href=https://github.com/intel/intel-graphics-compiler>https://github.com/intel/intel-graphics-compiler</a> igc &ndash;depth 1</p>
<p>$ mkdir build &amp;&amp; cd build
$ cmake ../igc -DCMAKE_INSTALL_PREFIX=&quot;/usr/local&quot;
$ make -j <code>nproc</code>
$ sudo make install
</code></pre></p></div><p>It should build cleanly. If it doesn't - please check any errors and make sure you have all the prerequisites.</p><h3><p>ocl-icd</p></h3><p>ocl-icd is an OpenCL loader - and is used to link opencl software when compiling. Make sure you are back in your usual oneapi-build directory.<br></p><div class="highlight js-code-highlight"><pre class="highlight plaintext"><code>$ pwd
~/src/oneapi-build
$ git clone https://github.com/OCL-dev/ocl-icd --depth 1
$ cd ocl-icd
$ ./bootstrap
$ ./configure
$ make
$ sudo make install
</code></pre></div><h3><p>Install GMMLib</p></h3><p>NEO requires GMMLib as one of its prerequisites so we will build that now.<br></p><div class="highlight js-code-highlight"><pre class="highlight plaintext"><code>$ pwd
~/src/oneapi-build
$ git clone https://github.com/intel/gmmlib --depth 1
$ cd gmmlib
$ mkdir build
$ cd build
$ cmake .. -DCMAKE_INSTALL_PREFIX="/usr/local"
$ make
$ sudo make install
</code></pre></div><h3><p>Install NEO</p></h3><p>NEO is the Intel Compute Runtime and is necessary for the SYCL based applications to talk to the GPU. Go back to your ~/src/oneapi-build directory.<br></p><div class="highlight js-code-highlight"><pre class="highlight plaintext"><code>$ pwd 
~/src/oneapi-build # please note this output will be different for you
$ mkdir neo-workspace
$ cd neo-workspace
$ git clone https://github.com/intel/compute-runtime neo –depth 1
$ cd neo
$ mkdir build
$ cd build
$ cmake .. -DCMAKE_INSTALL_PREFIX="/usr/local"
$ make
$ sudo make install
</code></pre></div><h2><p>Install level-zero</p></h2><p>This is the main part of oneAPI and interfaces with NEO or other run times. Since NEO is the only one at the moment - it will only work with Intel devices.<br></p><div class="highlight js-code-highlight"><pre class="highlight plaintext"><code>$ pwd
~/src/oneapi-build
$ git clone https://github.com/oneapi-src/level-zero --depth 1
$ mkdir build
$ cd build
$ cmake .. -DCMAKE_INSTALL_PREFIX="/usr/local"
$ make
$ sudo make install
</code></pre></div><h2><p>Install the DPC++ Compiler</p></h2><p>Now to build the SYCL Compiler.<br></p><div class="highlight js-code-highlight"><pre class="highlight plaintext"><code>$ pwd
~/src/oneapi-build
$ mkdir sycl_workspace &amp;&amp; cd sycl_workspace
$ export DPCPP_HOME=`pwd`
$ git clone https://github.com/intel/llvm.git -b sycl --depth 1
$ python3 $DPCPP_HOME/llvm/buildbot/configure.py --cmake-opt CMAKE_BUILD_PREFIX="/usr/local"
$ python3 $DPCPP_HOME/llvm/buildbot/compile.py
</code></pre></div><h2><p>Install oneTBB</p></h2><p>Finally, we need to install oneTBB<br></p><div class="highlight js-code-highlight"><pre class="highlight plaintext"><code>$ pwd
~/src/oneapi-build
$ git clone https://github.com/oneapi-src/oneTBB --depth 1
$ cd oneTBB
$ mkdir build
$ cd build
$ cmake .. -DCMAKE_INSTALL_PREFIX="/usr/local"
$ make
$ make install
</code></pre></div><h2><p>Set the LD_LIBRARY_PATH</p></h2><p>We need to make sure that the linker can find the proper libraries. The easiest way is to either set the LD_LIBRARY_PATH in your .bashrc or put it in /etc/environment.<br></p><div class="highlight js-code-highlight"><pre class="highlight plaintext"><code>$ export LD_LIBRARY_PATH="/usr/local/lib"
</code></pre></div><h2><p>Test the environment</p></h2><div class="highlight js-code-highlight"><pre class="highlight plaintext"><code>$ cd ~/src
$ mkdir simple-oneapi-app
$ cd simple-oneapi-app
$ cat &gt; simple-oneapi-app.cpp
#include &lt;sycl/sycl.hpp&gt;
<p>int main() {
// Creating buffer of 4 ints to be used inside the kernel code
sycl::buffer&lt;sycl::cl_int, 1&gt; Buffer(4);</p>
<p>// Creating SYCL queue
sycl::queue Queue;</p>
<p>// Size of index space for kernel
sycl::range&lt;1&gt; NumOfWorkItems{Buffer.size()};</p>
<p>// Submitting command group(work) to queue
Queue.submit([&amp;](sycl::handler &amp;cgh) {
// Getting write only access to the buffer on a device
auto Accessor = Buffer.get_access&lt;sycl::access::mode::write&gt;(cgh);
// Executing kernel
cgh.parallel_for&lt;class FillBuffer&gt;(
NumOfWorkItems, [=](sycl::id&lt;1&gt; WIid) {
// Fill buffer with indexes
Accessor[WIid] = (sycl::cl_int)WIid.get(0);
});
});</p>
<p>// Getting read only access to the buffer on the host.
// Implicit barrier waiting for queue to complete the work.
const auto HostAccessor = Buffer.get_access&lt;sycl::access::mode::read&gt;();</p>
<p>// Check the results
bool MismatchFound = false;
for (size_t I = 0; I &lt; Buffer.size(); ++I) {
if (HostAccessor[I] != I) {
std::cout &lt;&lt; &ldquo;The result is incorrect for element: &quot; &lt;&lt; I
&lt;&lt; &quot; , expected: &quot; &lt;&lt; I &lt;&lt; &quot; , got: &quot; &lt;&lt; HostAccessor[I]
&lt;&lt; std::endl;
MismatchFound = true;
}
}</p>
<p>if (!MismatchFound) {
std::cout &lt;&lt; &ldquo;The results are correct!&rdquo; &lt;&lt; std::endl;
}</p>
<p>return MismatchFound;
}</p>
<p>$ clang++ -fsycl simple-oneapi-app.cpp -o simple-oneapi-app
</code></pre></p></div><p>When you run the app you should get "Results are correct!".<br></p><div class="highlight js-code-highlight"><pre class="highlight plaintext"><code>$ ./simple-oneapi-app
Results are correct!
</code></pre></div><p>Now you've successfully built oneAPI from source!</p><p>Let me know if you have any issues with the instructions in the comments.</p><p>Photo by <a href="https://unsplash.com/@exdigy?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" rel="noopener noreferrer">Dominik Lückmann</a> on <a href="https://unsplash.com/photos/blue-and-red-cargo-ship-4aOhA4ptIY4?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" rel="noopener noreferrer">Unsplash</a></p><p><a href=https://dev.to/oneapi/building-oneapi-from-source-c50>Read full post on Dev.to</a></p></main><button class=sidebar-toggle id=sidebarToggle aria-label="Toggle blog sidebar">
<svg class="toggle-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20 24H4c-2.2.0-4-1.8-4-4V4c0-2.2 1.8-4 4-4h16c2.2.0 4 1.8 4 4v16c0 2.2-1.8 4-4 4zM4 2C2.9 2 2 2.9 2 4v16c0 1.1.9 2 2 2h16c1.1.0 2-.9 2-2V4c0-1.1-.9-2-2-2H4z"/><path d="M8 24c-.6.0-1-.4-1-1V1c0-.6.4-1 1-1s1 .4 1 1v22C9 23.6 8.6 24 8 24z"/><path d="M17 13c-.3.0-.5-.1-.7-.3l-3-3c-.4-.4-.4-1 0-1.4s1-.4 1.4.0l3 3c.4.4.4 1 0 1.4C17.5 12.9 17.3 13 17 13z"/><path d="M14 16c-.3.0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l3-3c.4-.4 1-.4 1.4.0s.4 1 0 1.4l-3 3C14.5 15.9 14.3 16 14 16z"/></svg>
</button>
<button class=sidebar-close id=sidebarClose aria-label="Close sidebar">
<svg class="toggle-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20 24H4c-2.2.0-4-1.8-4-4V4c0-2.2 1.8-4 4-4h16c2.2.0 4 1.8 4 4v16c0 2.2-1.8 4-4 4zM4 2C2.9 2 2 2.9 2 4v16c0 1.1.9 2 2 2h16c1.1.0 2-.9 2-2V4c0-1.1-.9-2-2-2H4z"/><path d="M8 24c-.6.0-1-.4-1-1V1c0-.6.4-1 1-1s1 .4 1 1v22C9 23.6 8.6 24 8 24z"/><path d="M14 13c-.3.0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l3-3c.4-.4 1-.4 1.4.0s.4 1 0 1.4l-3 3C14.5 12.9 14.3 13 14 13z"/><path d="M17 16c-.3.0-.5-.1-.7-.3l-3-3c-.4-.4-.4-1 0-1.4s1-.4 1.4.0l3 3c.4.4.4 1 0 1.4C17.5 15.9 17.3 16 17 16z"/></svg></button><aside class=blog-sidebar id=blogSidebar><div class=sidebar-content id=sidebarContent><h3>Recent Blog Posts</h3><div class=blog-source-group><h4 class=source-heading>GNOME Blog</h4><article class=sidebar-post><h5><a href=https://blogs.gnome.org/sri/2025/02/03/linux-app-summit-2025-call-for-papers-open-now/ target=_blank rel=noopener>Linux App Summit 2025 – Call for Papers Open Now</a></h5><div class=post-meta><span class=post-date>Feb 3, 2025</span></div></article><article class=sidebar-post><h5><a href=https://blogs.gnome.org/sri/2022/08/24/guadec-2022-guadalajara/ target=_blank rel=noopener>GUADEC 2022 – GUADALAJARA</a></h5><div class=post-meta><span class=post-date>Aug 24, 2022</span></div></article></div><div class=blog-source-group><h4 class=source-heading>Dev.to</h4><article class=sidebar-post><h5><a href=https://dev.to/sramkrishna/linux-app-summit-2025-cfp-is-open-3434 target=_blank rel=noopener>Linux App Summit 2025 CfP is Open!</a></h5><div class=post-meta><span class=post-date>Feb 3, 2025</span></div></article><article class=sidebar-post><h5><a href=https://dev.to/oneapi/looking-forward-to-2024-11pf target=_blank rel=noopener>Looking forward to 2024!</a></h5><div class=post-meta><span class=post-date>Dec 22, 2023</span></div></article></div></div></aside><footer><div class=container><p>&copy; 2025 Sriram Ramkrishna. Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>.</p></div></footer><script src=/js/sidebar.js></script><script src=/js/carousel.js></script></body></html>